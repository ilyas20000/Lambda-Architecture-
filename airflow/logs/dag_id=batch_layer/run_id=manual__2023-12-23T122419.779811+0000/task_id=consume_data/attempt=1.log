[2023-12-23T12:24:23.209+0000] {taskinstance.py:1957} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: batch_layer.consume_data manual__2023-12-23T12:24:19.779811+00:00 [queued]>
[2023-12-23T12:24:23.215+0000] {taskinstance.py:1957} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: batch_layer.consume_data manual__2023-12-23T12:24:19.779811+00:00 [queued]>
[2023-12-23T12:24:23.215+0000] {taskinstance.py:2171} INFO - Starting attempt 1 of 2
[2023-12-23T12:24:23.228+0000] {taskinstance.py:2192} INFO - Executing <Task(PythonOperator): consume_data> on 2023-12-23 12:24:19.779811+00:00
[2023-12-23T12:24:23.233+0000] {standard_task_runner.py:60} INFO - Started process 1212 to run task
[2023-12-23T12:24:23.237+0000] {standard_task_runner.py:87} INFO - Running: ['airflow', 'tasks', 'run', 'batch_layer', 'consume_data', 'manual__2023-12-23T12:24:19.779811+00:00', '--job-id', '18', '--raw', '--subdir', 'DAGS_FOLDER/BatchLayerDag.py', '--cfg-path', '/tmp/tmpdeg5gddm']
[2023-12-23T12:24:23.240+0000] {standard_task_runner.py:88} INFO - Job 18: Subtask consume_data
[2023-12-23T12:24:23.280+0000] {task_command.py:423} INFO - Running <TaskInstance: batch_layer.consume_data manual__2023-12-23T12:24:19.779811+00:00 [running]> on host 7de9f6b6c8f6
[2023-12-23T12:24:23.332+0000] {taskinstance.py:2481} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='airflow@example.com' AIRFLOW_CTX_DAG_OWNER='airflow' AIRFLOW_CTX_DAG_ID='batch_layer' AIRFLOW_CTX_TASK_ID='consume_data' AIRFLOW_CTX_EXECUTION_DATE='2023-12-23T12:24:19.779811+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='manual__2023-12-23T12:24:19.779811+00:00'
[2023-12-23T12:24:23.400+0000] {hive.py:475} INFO - USE `finnhub_db`
[2023-12-23T12:24:23.441+0000] {hive.py:475} INFO - 
        CREATE TABLE IF NOT EXISTS finnhub_table
        ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.avro.AvroSerDe'
        STORED AS INPUTFORMAT 'org.apache.hadoop.hive.ql.io.avro.AvroContainerInputFormat'
        OUTPUTFORMAT 'org.apache.hadoop.hive.ql.io.avro.AvroContainerOutputFormat'
        TBLPROPERTIES ('avro.schema.literal'='{"type": "record", "name": "TradeRecord", "fields": [{"name": "p", "type": "double"}, {"name": "exchange", "type": "string"}, {"name": "crypto_pair", "type": "string"}, {"name": "t", "type": "long"}, {"name": "v", "type": "double"}]}')
    
[2023-12-23T12:24:23.520+0000] {hive.py:475} INFO - USE `finnhub_db`
[2023-12-23T12:24:23.562+0000] {hive.py:475} INFO - 
        CREATE TABLE IF NOT EXISTS temp_avro_data
        ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.avro.AvroSerDe'
        STORED AS INPUTFORMAT 'org.apache.hadoop.hive.ql.io.avro.AvroContainerInputFormat'
        OUTPUTFORMAT 'org.apache.hadoop.hive.ql.io.avro.AvroContainerOutputFormat'
        TBLPROPERTIES ('avro.schema.literal'='{"type": "record", "name": "TradeRecord", "fields": [{"name": "p", "type": "double"}, {"name": "exchange", "type": "string"}, {"name": "crypto_pair", "type": "string"}, {"name": "t", "type": "long"}, {"name": "v", "type": "double"}]}')
    
[2023-12-23T12:24:23.577+0000] {logging_mixin.py:188} INFO - [[{'c': None, 'p': 43537.24, 's': 'BINANCE:BTCUSDT', 't': 1703330004107, 'v': 0.0023}, {'c': None, 'p': 43537.25, 's': 'BINANCE:BTCUSDT', 't': 1703330004462, 'v': 0.00927}, {'c': None, 'p': 2282.24, 's': 'BINANCE:ETHUSDT', 't': 1703330004534, 'v': 0.0224}, {'c': None, 'p': 43537.24, 's': 'BINANCE:BTCUSDT', 't': 1703330004608, 'v': 0.00443}, {'c': None, 'p': 43537.25, 's': 'BINANCE:BTCUSDT', 't': 1703330004618, 'v': 0.0028}], [{'c': None, 'p': 2282.25, 's': 'BINANCE:ETHUSDT', 't': 1703330004841, 'v': 0.0088}, {'c': None, 'p': 43537.24, 's': 'BINANCE:BTCUSDT', 't': 1703330005171, 'v': 0.00038}], [{'c': None, 'p': 43537.24, 's': 'BINANCE:BTCUSDT', 't': 1703330005783, 'v': 0.00925}, {'c': None, 'p': 43537.25, 's': 'BINANCE:BTCUSDT', 't': 1703330005955, 'v': 0.00093}, {'c': None, 'p': 43537.25, 's': 'BINANCE:BTCUSDT', 't': 1703330006093, 'v': 0.00354}, {'c': None, 'p': 43537.25, 's': 'BINANCE:BTCUSDT', 't': 1703330006219, 'v': 0.00032}, {'c': None, 'p': 2282.24, 's': 'BINANCE:ETHUSDT', 't': 1703330006229, 'v': 0.211}], [{'c': None, 'p': 2282.25, 's': 'BINANCE:ETHUSDT', 't': 1703330007328, 'v': 0.0032}, {'c': None, 'p': 2282.25, 's': 'BINANCE:ETHUSDT', 't': 1703330007358, 'v': 0.0022}, {'c': None, 'p': 43537.24, 's': 'BINANCE:BTCUSDT', 't': 1703330007387, 'v': 0.00663}, {'c': None, 'p': 43537.24, 's': 'BINANCE:BTCUSDT', 't': 1703330007393, 'v': 0.01468}], [{'c': None, 'p': 2282.25, 's': 'BINANCE:ETHUSDT', 't': 1703330007865, 'v': 0.2141}, {'c': None, 'p': 2282.25, 's': 'BINANCE:ETHUSDT', 't': 1703330007865, 'v': 0.224}, {'c': None, 'p': 43537.24, 's': 'BINANCE:BTCUSDT', 't': 1703330008121, 'v': 0.0033}, {'c': None, 'p': 43537.24, 's': 'BINANCE:BTCUSDT', 't': 1703330008121, 'v': 0.00035}, {'c': None, 'p': 43537.24, 's': 'BINANCE:BTCUSDT', 't': 1703330008121, 'v': 4e-05}, {'c': None, 'p': 2282.24, 's': 'BINANCE:ETHUSDT', 't': 1703330008474, 'v': 0.0222}, {'c': None, 'p': 2282.24, 's': 'BINANCE:ETHUSDT', 't': 1703330008474, 'v': 0.0188}, {'c': None, 'p': 2282.24, 's': 'BINANCE:ETHUSDT', 't': 1703330008474, 'v': 0.0088}, {'c': None, 'p': 43537.25, 's': 'BINANCE:BTCUSDT', 't': 1703330008571, 'v': 0.00115}], [{'c': None, 'p': 43537.24, 's': 'BINANCE:BTCUSDT', 't': 1703330008772, 'v': 0.00056}, {'c': None, 'p': 2282.24, 's': 'BINANCE:ETHUSDT', 't': 1703330008913, 'v': 0.0106}, {'c': None, 'p': 2282.24, 's': 'BINANCE:ETHUSDT', 't': 1703330008931, 'v': 0.0222}, {'c': None, 'p': 2282.25, 's': 'BINANCE:ETHUSDT', 't': 1703330008955, 'v': 0.0438}, {'c': None, 'p': 2282.24, 's': 'BINANCE:ETHUSDT', 't': 1703330008987, 'v': 0.0084}, {'c': None, 'p': 2282.24, 's': 'BINANCE:ETHUSDT', 't': 1703330008987, 'v': 0.0025}, {'c': None, 'p': 2282.24, 's': 'BINANCE:ETHUSDT', 't': 1703330008987, 'v': 0.0079}, {'c': None, 'p': 43537.24, 's': 'BINANCE:BTCUSDT', 't': 1703330009220, 'v': 0.00036}, {'c': None, 'p': 2282.25, 's': 'BINANCE:ETHUSDT', 't': 1703330009228, 'v': 0.3018}, {'c': None, 'p': 43537.24, 's': 'BINANCE:BTCUSDT', 't': 1703330009262, 'v': 0.001}], [{'c': None, 'p': 43537.25, 's': 'BINANCE:BTCUSDT', 't': 1703330009533, 'v': 0.00168}, {'c': None, 'p': 2282.25, 's': 'BINANCE:ETHUSDT', 't': 1703330009666, 'v': 0.0344}], [{'c': None, 'p': 43537.24, 's': 'BINANCE:BTCUSDT', 't': 1703330009736, 'v': 0.00296}, {'c': None, 'p': 2282.25, 's': 'BINANCE:ETHUSDT', 't': 1703330009821, 'v': 0.0036}, {'c': None, 'p': 43537.24, 's': 'BINANCE:BTCUSDT', 't': 1703330010041, 'v': 0.00102}, {'c': None, 'p': 43537.24, 's': 'BINANCE:BTCUSDT', 't': 1703330010041, 'v': 0.00027}, {'c': None, 'p': 43537.24, 's': 'BINANCE:BTCUSDT', 't': 1703330010041, 'v': 0.00223}, {'c': None, 'p': 43537.24, 's': 'BINANCE:BTCUSDT', 't': 1703330010041, 'v': 0.00023}, {'c': None, 'p': 43537.24, 's': 'BINANCE:BTCUSDT', 't': 1703330010041, 'v': 0.00168}, {'c': None, 'p': 43537.24, 's': 'BINANCE:BTCUSDT', 't': 1703330010041, 'v': 0.00105}, {'c': None, 'p': 43537.24, 's': 'BINANCE:BTCUSDT', 't': 1703330010041, 'v': 0.10242}, {'c': None, 'p': 43537.24, 's': 'BINANCE:BTCUSDT', 't': 1703330010385, 'v': 0.00223}], [{'c': None, 'p': 43537.25, 's': 'BINANCE:BTCUSDT', 't': 1703330010605, 'v': 0.0023}], [{'c': None, 'p': 2282.24, 's': 'BINANCE:ETHUSDT', 't': 1703330010730, 'v': 0.0043}, {'c': None, 'p': 2282.24, 's': 'BINANCE:ETHUSDT', 't': 1703330010730, 'v': 2.1497}, {'c': None, 'p': 2282.24, 's': 'BINANCE:ETHUSDT', 't': 1703330010730, 'v': 0.8599}, {'c': None, 'p': 2282.24, 's': 'BINANCE:ETHUSDT', 't': 1703330010730, 'v': 0.8599}, {'c': None, 'p': 2282.24, 's': 'BINANCE:ETHUSDT', 't': 1703330010730, 'v': 1.0157}, {'c': None, 'p': 2282.25, 's': 'BINANCE:ETHUSDT', 't': 1703330011532, 'v': 0.0118}, {'c': None, 'p': 43537.24, 's': 'BINANCE:BTCUSDT', 't': 1703330011563, 'v': 0.001}]]
[2023-12-23T12:24:23.578+0000] {hive.py:475} INFO - 
                            INSERT INTO temp_avro_data
                            VALUES (

                                43537.24,
                                'BINANCE',  -- New 'exchange' attribute
                                'BTCUSDT',  -- New 'crypto_pair' attribute
                                1703330004107,
                                0.0023
                            )
                        
[2023-12-23T12:24:26.476+0000] {hive.py:475} INFO - 
                            INSERT INTO temp_avro_data
                            VALUES (

                                43537.25,
                                'BINANCE',  -- New 'exchange' attribute
                                'BTCUSDT',  -- New 'crypto_pair' attribute
                                1703330004462,
                                0.00927
                            )
                        
[2023-12-23T12:24:29.040+0000] {hive.py:475} INFO - 
                            INSERT INTO temp_avro_data
                            VALUES (

                                2282.24,
                                'BINANCE',  -- New 'exchange' attribute
                                'ETHUSDT',  -- New 'crypto_pair' attribute
                                1703330004534,
                                0.0224
                            )
                        
[2023-12-23T12:24:31.614+0000] {hive.py:475} INFO - 
                            INSERT INTO temp_avro_data
                            VALUES (

                                43537.24,
                                'BINANCE',  -- New 'exchange' attribute
                                'BTCUSDT',  -- New 'crypto_pair' attribute
                                1703330004608,
                                0.00443
                            )
                        
[2023-12-23T12:24:33.330+0000] {local_task_job_runner.py:302} WARNING - State of this instance has been externally set to success. Terminating instance.
[2023-12-23T12:24:33.334+0000] {process_utils.py:131} INFO - Sending Signals.SIGTERM to group 1212. PIDs of all processes in the group: [1212]
[2023-12-23T12:24:33.335+0000] {process_utils.py:86} INFO - Sending the signal Signals.SIGTERM to group 1212
[2023-12-23T12:24:33.335+0000] {taskinstance.py:2451} ERROR - Received SIGTERM. Terminating subprocesses.
[2023-12-23T12:24:33.336+0000] {logging_mixin.py:188} INFO - Error processing and inserting into Hive: Task received SIGTERM signal
[2023-12-23T12:24:33.337+0000] {logging_mixin.py:188} INFO - finish
[2023-12-23T12:24:34.188+0000] {taskinstance.py:2699} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/models/taskinstance.py", line 433, in _execute_task
    result = execute_callable(context=context, **execute_callable_kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 199, in execute
    return_value = self.execute_callable()
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 216, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
  File "/opt/airflow/dags/BatchLayerDag.py", line 18, in save_data_to_hive
    hive_consumer.kafka_consumer_worker()
  File "/opt/airflow/dags/batch_consumer.py", line 177, in kafka_consumer_worker
    connection.close()
  File "/home/airflow/.local/lib/python3.8/site-packages/pyhive/hive.py", line 337, in close
    response = self._client.CloseSession(req)
  File "/home/airflow/.local/lib/python3.8/site-packages/TCLIService/TCLIService.py", line 218, in CloseSession
    return self.recv_CloseSession()
  File "/home/airflow/.local/lib/python3.8/site-packages/TCLIService/TCLIService.py", line 237, in recv_CloseSession
    result.read(iprot)
  File "/home/airflow/.local/lib/python3.8/site-packages/TCLIService/TCLIService.py", line 1534, in read
    self.success.read(iprot)
  File "/home/airflow/.local/lib/python3.8/site-packages/TCLIService/ttypes.py", line 3613, in read
    iprot.skip(ftype)
  File "/home/airflow/.local/lib/python3.8/site-packages/thrift/protocol/TProtocol.py", line 214, in skip
    self.skip(ttype)
  File "/home/airflow/.local/lib/python3.8/site-packages/thrift/protocol/TProtocol.py", line 214, in skip
    self.skip(ttype)
  File "/home/airflow/.local/lib/python3.8/site-packages/thrift/protocol/TProtocol.py", line 207, in skip
    self.readString()
  File "/home/airflow/.local/lib/python3.8/site-packages/thrift/protocol/TProtocol.py", line 185, in readString
    return binary_to_str(self.readBinary())
  File "/home/airflow/.local/lib/python3.8/site-packages/thrift/compat.py", line 40, in binary_to_str
    return bin_val.decode('utf8')
UnicodeDecodeError: 'utf-8' codec can't decode byte 0xe0 in position 0: invalid continuation byte
[2023-12-23T12:24:34.197+0000] {taskinstance.py:1138} INFO - Marking task as FAILED. dag_id=batch_layer, task_id=consume_data, execution_date=20231223T122419, start_date=20231223T122423, end_date=20231223T122434
[2023-12-23T12:24:34.210+0000] {standard_task_runner.py:107} ERROR - Failed to execute job 18 for task consume_data ('utf-8' codec can't decode byte 0xe0 in position 0: invalid continuation byte; 1212)
[2023-12-23T12:24:34.231+0000] {process_utils.py:79} INFO - Process psutil.Process(pid=1212, status='terminated', exitcode=1, started='12:24:22') (1212) terminated with exit code 1
